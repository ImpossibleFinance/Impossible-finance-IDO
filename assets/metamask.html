<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <script src="https://cdn.jsdelivr.net/npm/web3@1.6.0/dist/web3.min.js"></script>
  <link rel = ¨stylesheet¨ type = ¨text/css¨ href = ¨style.css¨>
</head>
<body class="blur">

  <button onclick = "connect()">Connect to MetaMask</button>
  <div id = "balance"></div>

  <script>
    async function connect() {
      if (typeof window.ethereum === 'undefined') {
        alert('Please install Metamask to use this feature');
        return;
      }

      try {
        await ethereum.request({ method: 'eth_requestAccounts' });
        console.log('Connected to MetaMask!');

        await ethereum.request({
          method: 'wallet_switchEthereumChain',
          params: [{ chainId: '0x38' }]
        });

        const web3 = new Web3(window.ethereum);
        const accounts = await web3.eth.getAccounts();

        const tokenAddress = '0x0b15Ddf19D47E6a86A56148fb4aFFFc6929BcB89';
        const tokenAbi = [
          {
            "inputs": [
              {
                "internalType": "address",
                "name": "",
                "type": "address"
              }
            ],
            "name": "balanceOf",
            "outputs": [
              {
                "internalType": "uint256",
                "name": "",
                "type": "uint256"
              }
            ],
            "stateMutability": "view",
            "type": "function"
          }
        ];
        let tokenContract = new web3.eth.Contract(tokenAbi, tokenAddress);
        const balance = await tokenContract.methods.balanceOf(accounts[0]).call();
        console.log('Token:', web3.utils.fromWei(balance, "ether"), 'IDIA');

        //window.parent.postMessage({token_balance: balance}, '*');
        
        document.getElementById("balance").innerHTML = balance;
        console.log(document)
        if (balance == '0') {
          document.body.classList.remove('blur');
        }
        //return balance

      } catch (error) {
        console.error(error);
      }
    }
  </script>
</body>
</html>
